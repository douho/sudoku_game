<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•¸ç¨éŠæˆ² Sudoku - Art Edition</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (for JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            margin: 0;
            overflow: hidden; /* é˜²æ­¢èƒŒæ™¯è¶…å‡º */
            background-color: #0f172a; /* æ·±è—åº•è‰² */
        }
        
        /* èƒŒæ™¯ Canvas */
        #art-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; /* æ”¾åœ¨æœ€åº•å±¤ */
        }

        /* éš±è—æ²è»¸ä½†ä¿ç•™åŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* ç°¡å–®çš„å½ˆè·³å‹•ç•« */
        @keyframes bounce-short {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-bounce-short {
            animation: bounce-short 0.5s ease-in-out infinite;
        }

        /* ç»ç’ƒæ“¬æ…‹æ¨¡ç³Š */
        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* æ ¼å­é‚Šæ¡†é¡è‰²èª¿æ•´ */
        .sudoku-grid {
            border-color: rgba(255, 255, 255, 0.3);
        }
        .cell-border {
            border-color: rgba(255, 255, 255, 0.15);
        }
        .cell-border-bold-r {
            border-right: 2px solid rgba(255, 255, 255, 0.5);
        }
        .cell-border-bold-b {
            border-bottom: 2px solid rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body class="text-slate-200">

    <!-- èƒŒæ™¯ç•«å¸ƒ -->
    <canvas id="art-canvas"></canvas>
    
    <div id="root" class="h-screen w-full overflow-y-auto"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // --- ç”Ÿæˆå¼è—è¡“èƒŒæ™¯é‚è¼¯ ---
        const GenerativeBackground = () => {
            const canvasRef = useRef(null);

            useEffect(() => {
                const canvas = document.getElementById('art-canvas');
                const ctx = canvas.getContext('2d');
                let animationFrameId;
                
                let width, height;
                let particles = [];

                // è¨­å®šç•«å¸ƒå°ºå¯¸
                const resize = () => {
                    width = canvas.width = window.innerWidth;
                    height = canvas.height = window.innerHeight;
                };
                window.addEventListener('resize', resize);
                resize();

                // ç²’å­é¡åˆ¥
                class Particle {
                    constructor() {
                        this.x = Math.random() * width;
                        this.y = Math.random() * height;
                        this.vx = (Math.random() - 0.5) * 0.5; // é€Ÿåº¦æ¥µæ…¢
                        this.vy = (Math.random() - 0.5) * 0.5;
                        this.radius = Math.random() * 100 + 50; // å·¨å¤§æ¨¡ç³Šå…‰é»
                        // éš¨æ©Ÿé¡è‰²ï¼šé’è‰²ã€ç´«è‰²ã€ç²‰è‰²ç³»
                        const colors = [
                            'hsla(220, 70%, 50%, 0.15)', // è—
                            'hsla(280, 70%, 50%, 0.15)', // ç´«
                            'hsla(320, 70%, 60%, 0.15)', // ç²‰
                            'hsla(180, 70%, 50%, 0.15)'  // é’
                        ];
                        this.color = colors[Math.floor(Math.random() * colors.length)];
                    }

                    update() {
                        this.x += this.vx;
                        this.y += this.vy;

                        // é‚Šç•Œåå½ˆ
                        if (this.x < -100 || this.x > width + 100) this.vx *= -1;
                        if (this.y < -100 || this.y > height + 100) this.vy *= -1;
                    }

                    draw(ctx) {
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                        ctx.fillStyle = this.color;
                        ctx.fill();
                    }
                }

                // åˆå§‹åŒ–ç²’å­
                const initParticles = () => {
                    particles = [];
                    const particleCount = 15; // æ•¸é‡ä¸ç”¨å¤šï¼Œå› ç‚ºå¾ˆå¤§
                    for (let i = 0; i < particleCount; i++) {
                        particles.push(new Particle());
                    }
                };
                initParticles();

                // å‹•ç•«è¿´åœˆ
                const animate = () => {
                    ctx.clearRect(0, 0, width, height);
                    
                    // è®“èƒŒæ™¯æœ‰é»æ®˜å½±æ•ˆæœï¼Œå‰µé€ æµå‹•æ„Ÿ
                    // ctx.fillStyle = 'rgba(15, 23, 42, 0.1)';
                    // ctx.fillRect(0, 0, width, height);

                    // å•Ÿç”¨æ··åˆæ¨¡å¼è®“å…‰é»ç–ŠåŠ æ›´æ¼‚äº®
                    ctx.globalCompositeOperation = 'screen'; 

                    particles.forEach(p => {
                        p.update();
                        p.draw(ctx);
                    });

                    // é‚„åŸæ··åˆæ¨¡å¼
                    ctx.globalCompositeOperation = 'source-over';

                    animationFrameId = requestAnimationFrame(animate);
                };
                animate();

                return () => {
                    window.removeEventListener('resize', resize);
                    cancelAnimationFrame(animationFrameId);
                };
            }, []);

            return null; // é€™å€‹çµ„ä»¶ä¸æ¸²æŸ“ DOMï¼Œåªè² è²¬ Canvas
        };

        // --- å…§åµŒåœ–æ¨™å…ƒä»¶ ---

        const RefreshCw = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" />
                <path d="M21 3v5h-5" />
                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" />
                <path d="M3 21v-5h5" />
            </svg>
        );

        const Trophy = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" />
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" />
                <path d="M4 22h16" />
                <path d="M12 15.4V22" />
                <path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2v-2.26C5.19 13.47 4 11.38 4 9a7 7 0 0 1 7-7Z" />
            </svg>
        );

        const Pencil = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" />
                <path d="m15 5 4 4" />
            </svg>
        );

        const Eraser = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21" />
                <path d="M22 21H7" />
                <path d="m5 11 9 9" />
            </svg>
        );

        const Clock = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10" />
                <polyline points="12 6 12 12 16 14" />
            </svg>
        );

        const Play = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polygon points="5 3 19 12 5 21 5 3" />
            </svg>
        );

        // --- æ•¸ç¨é‚è¼¯æ ¸å¿ƒ ---

        const isValid = (board, row, col, num) => {
            for (let i = 0; i < 9; i++) {
                const m = 3 * Math.floor(row / 3) + Math.floor(i / 3);
                const n = 3 * Math.floor(col / 3) + i % 3;
                if (board[row][i] === num || board[i][col] === num || board[m][n] === num) {
                    return false;
                }
            }
            return true;
        };

        const solveSudoku = (board) => {
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    if (board[row][col] === 0) {
                        for (let num = 1; num <= 9; num++) {
                            if (isValid(board, row, col, num)) {
                                board[row][col] = num;
                                if (solveSudoku(board)) return true;
                                board[row][col] = 0;
                            }
                        }
                        return false;
                    }
                }
            }
            return true;
        };

        const generateFullBoard = () => {
            const board = Array.from({ length: 9 }, () => Array(9).fill(0));
            for (let i = 0; i < 9; i += 3) fillBox(board, i, i);
            solveSudoku(board);
            return board;
        };

        const fillBox = (board, row, col) => {
            let num;
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    do {
                        num = Math.floor(Math.random() * 9) + 1;
                    } while (!isSafeInBox(board, row, col, num));
                    board[row + i][col + j] = num;
                }
            }
        };

        const isSafeInBox = (board, rowStart, colStart, num) => {
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    if (board[rowStart + i][colStart + j] === num) return false;
                }
            }
            return true;
        };

        const removeNumbers = (board, difficulty) => {
            const newBoard = board.map(row => [...row]);
            let holes = 0;
            if (difficulty === 'Easy') holes = 30;
            if (difficulty === 'Medium') holes = 45;
            if (difficulty === 'Hard') holes = 55;

            while (holes > 0) {
                let row = Math.floor(Math.random() * 9);
                let col = Math.floor(Math.random() * 9);
                if (newBoard[row][col] !== 0) {
                    newBoard[row][col] = 0;
                    holes--;
                }
            }
            return newBoard;
        };

        // --- Main App Component ---

        function App() {
            const [initialBoard, setInitialBoard] = useState([]); 
            const [solvedBoard, setSolvedBoard] = useState([]);   
            const [gameBoard, setGameBoard] = useState([]);       
            const [notesBoard, setNotesBoard] = useState([]);
            const [selectedCell, setSelectedCell] = useState(null); 
            const [difficulty, setDifficulty] = useState('Easy');
            const [isWon, setIsWon] = useState(false);
            const [loading, setLoading] = useState(true);
            const [isNoteMode, setIsNoteMode] = useState(false);
            const [timer, setTimer] = useState(0); 
            
            // æ–°å¢ï¼šéŠæˆ²æ˜¯å¦é–‹å§‹çš„ç‹€æ…‹
            const [isGameStarted, setIsGameStarted] = useState(false);

            const startNewGame = useCallback((diff = difficulty) => {
                setLoading(true);
                localStorage.removeItem('sudoku-game-state');
                
                // é–‹å§‹æ–°éŠæˆ²æ™‚ï¼Œå…ˆæš«åœï¼Œé¡¯ç¤ºé–‹å§‹æŒ‰éˆ•
                setIsGameStarted(false);

                setTimeout(() => {
                    const full = generateFullBoard();
                    const solved = full.map(row => [...row]);
                    const puzzle = removeNumbers(full, diff);
                    
                    setSolvedBoard(solved);
                    setInitialBoard(puzzle.map(row => [...row]));
                    setGameBoard(puzzle.map(row => [...row]));
                    
                    const initialNotes = Array.from({ length: 9 }, () => Array.from({ length: 9 }, () => []));
                    setNotesBoard(initialNotes);

                    setIsWon(false);
                    setSelectedCell(null);
                    setTimer(0);
                    setLoading(false);
                }, 50); 
            }, [difficulty]);

            useEffect(() => {
                const savedState = localStorage.getItem('sudoku-game-state');
                if (savedState) {
                    try {
                        const parsed = JSON.parse(savedState);
                        if (parsed.gameBoard && parsed.initialBoard) {
                            setInitialBoard(parsed.initialBoard);
                            setSolvedBoard(parsed.solvedBoard);
                            setGameBoard(parsed.gameBoard);
                            setNotesBoard(parsed.notesBoard);
                            setDifficulty(parsed.difficulty);
                            setIsWon(parsed.isWon);
                            setTimer(parsed.timer || 0);
                            setLoading(false);
                            // å³ä½¿æ˜¯è¼‰å…¥å­˜æª”ï¼Œä¹Ÿå…ˆè¨­å®šç‚ºæœªé–‹å§‹ï¼Œè®“ä½¿ç”¨è€…é»æ“Šã€Œç¹¼çºŒã€
                            setIsGameStarted(false);
                            return;
                        }
                    } catch (e) {
                        console.error("è®€å–å­˜æª”å¤±æ•—ï¼Œé–‹å§‹æ–°éŠæˆ²", e);
                    }
                }
                startNewGame();
            }, []);

            // è¨ˆæ™‚å™¨é‚è¼¯ï¼šåªåœ¨ isGameStarted ç‚º true æ™‚åŸ·è¡Œ
            useEffect(() => {
                let interval;
                if (!loading && !isWon && isGameStarted) {
                    interval = setInterval(() => {
                        setTimer(prev => prev + 1);
                    }, 1000);
                }
                return () => clearInterval(interval);
            }, [loading, isWon, isGameStarted]);

            useEffect(() => {
                if (loading || initialBoard.length === 0) return;

                const stateToSave = {
                    initialBoard,
                    solvedBoard,
                    gameBoard,
                    notesBoard,
                    difficulty,
                    isWon,
                    timer
                };
                localStorage.setItem('sudoku-game-state', JSON.stringify(stateToSave));
            }, [gameBoard, notesBoard, difficulty, isWon, timer]);

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            };

            const handleNumberInput = (num) => {
                if (isWon || !selectedCell || !isGameStarted) return;
                const [r, c] = selectedCell;
                
                if (initialBoard[r][c] !== 0) return;

                if (isNoteMode) {
                    if (gameBoard[r][c] !== 0) return;

                    const newNotes = [...notesBoard];
                    newNotes[r] = [...newNotes[r]];
                    const currentNotes = new Set(newNotes[r][c]);

                    if (currentNotes.has(num)) {
                        currentNotes.delete(num);
                    } else {
                        currentNotes.add(num);
                    }
                    
                    newNotes[r][c] = Array.from(currentNotes).sort();
                    setNotesBoard(newNotes);

                } else {
                    const newBoard = [...gameBoard];
                    
                    if (newBoard[r][c] === num) {
                        newBoard[r][c] = 0;
                    } else {
                        newBoard[r][c] = num;
                        const newNotes = [...notesBoard];
                        newNotes[r] = [...newNotes[r]];
                        newNotes[r][c] = [];
                        setNotesBoard(newNotes);
                    }
                    
                    setGameBoard(newBoard);
                    checkWin(newBoard);
                }
            };

            const handleErase = () => {
                if (isWon || !selectedCell || !isGameStarted) return;
                const [r, c] = selectedCell;
                if (initialBoard[r][c] !== 0) return;

                const newBoard = [...gameBoard];
                newBoard[r][c] = 0;
                setGameBoard(newBoard);

                const newNotes = [...notesBoard];
                newNotes[r][c] = [];
                setNotesBoard(newNotes);
            };

            const checkWin = (currentBoard) => {
                for (let i = 0; i < 9; i++) {
                    for (let j = 0; j < 9; j++) {
                        if (currentBoard[i][j] !== solvedBoard[i][j]) return;
                    }
                }
                setIsWon(true);
            };

            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (isWon || !isGameStarted) return;
                    
                    if (e.key >= '1' && e.key <= '9') {
                        handleNumberInput(parseInt(e.key));
                    }
                    
                    if (e.key === 'Backspace' || e.key === 'Delete') {
                        handleErase();
                    }

                    if (e.key === 'n' || e.key === 'N') {
                        setIsNoteMode(prev => !prev);
                    }

                    if (selectedCell) {
                        const [r, c] = selectedCell;
                        if (e.key === 'ArrowUp') setSelectedCell([Math.max(0, r - 1), c]);
                        if (e.key === 'ArrowDown') setSelectedCell([Math.min(8, r + 1), c]);
                        if (e.key === 'ArrowLeft') setSelectedCell([r, Math.max(0, c - 1)]);
                        if (e.key === 'ArrowRight') setSelectedCell([r, Math.min(8, c + 1)]);
                    }
                };
                
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [selectedCell, gameBoard, notesBoard, isWon, isNoteMode, isGameStarted]);

            const getCellClass = (r, c) => {
                const val = gameBoard[r][c];
                const isInitial = initialBoard[r][c] !== 0;
                const isSelected = selectedCell && selectedCell[0] === r && selectedCell[1] === c;
                
                let isRelated = false;
                let isSameNumber = false;

                if (selectedCell) {
                    const [sr, sc] = selectedCell;
                    const sVal = gameBoard[sr][sc];
                    
                    if (r === sr || c === sc || (Math.floor(r/3) === Math.floor(sr/3) && Math.floor(c/3) === Math.floor(sc/3))) {
                        isRelated = true;
                    }
                    if (sVal !== 0 && val === sVal) {
                        isSameNumber = true;
                    }
                }

                // åŸºç¤æ¨£å¼ï¼šé€æ˜èƒŒæ™¯ï¼Œç´°é‚Šæ¡†
                let baseClass = "w-full h-full relative flex items-center justify-center cursor-pointer transition-colors duration-200 select-none cell-border border-[0.5px] ";
                
                // åŠ ç²—é‚Šæ¡†
                if (c % 3 === 2 && c !== 8) baseClass += "cell-border-bold-r ";
                if (r % 3 === 2 && r !== 8) baseClass += "cell-border-bold-b ";

                // ç‹€æ…‹é¡è‰² (Glassmorphism é¢¨æ ¼)
                if (isSelected) {
                    baseClass += "bg-cyan-500/80 text-white shadow-[0_0_15px_rgba(6,182,212,0.6)] z-10 ";
                } else if (isSameNumber) {
                    baseClass += "bg-cyan-900/40 "; // ç›¸åŒæ•¸å­—é«˜äº®
                } else if (isRelated) {
                    baseClass += "bg-slate-700/30 "; // é—œè¯å€åŸŸ
                } else {
                    baseClass += "hover:bg-white/5 "; // hover æ•ˆæœ
                }

                return baseClass;
            };

            const renderCellContent = (r, c) => {
                const val = gameBoard[r][c];
                const isInitial = initialBoard[r][c] !== 0;
                const isSelected = selectedCell && selectedCell[0] === r && selectedCell[1] === c;

                if (val !== 0) {
                    return (
                        <span className={`text-lg sm:text-2xl font-medium drop-shadow-md ${
                            !isSelected && !isInitial ? 'text-cyan-400' : '' // ç©å®¶å¡«çš„æ•¸å­—ï¼šäº®é’è‰²
                        } ${isInitial ? 'font-bold text-white' : ''} ${ // é¡Œç›®æ•¸å­—ï¼šç™½è‰²
                            isSelected ? 'text-white' : ''
                        }`}>
                            {val}
                        </span>
                    );
                }

                const notes = notesBoard[r] && notesBoard[r][c];
                if (notes && notes.length > 0) {
                    return (
                        <div className="grid grid-cols-3 gap-0 w-full h-full p-[2px]">
                            {[1,2,3,4,5,6,7,8,9].map(n => (
                                <div key={n} className="flex items-center justify-center text-[8px] sm:text-[10px] leading-none text-pink-300/80 font-medium">
                                    {notes.includes(n) ? n : ''}
                                </div>
                            ))}
                        </div>
                    );
                }
                
                return null;
            };

            return (
                <div className="relative min-h-screen flex flex-col items-center py-8 font-sans text-slate-200">
                    <GenerativeBackground />
                    
                    <div className="mb-6 flex flex-col items-center w-full max-w-[450px] px-4 z-10">
                        <div className="flex justify-between items-center w-full mb-4">
                            <h1 className="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400 drop-shadow-sm">
                                æ•¸ç¨ Sudoku
                            </h1>
                            <div className="flex items-center gap-3">
                                <div className="flex items-center text-cyan-100 bg-slate-800/50 backdrop-blur-md px-3 py-1.5 rounded-lg border border-slate-700 shadow-sm">
                                    <Clock className="w-4 h-4 mr-2 text-cyan-400" />
                                    <span className="font-mono font-medium">{formatTime(timer)}</span>
                                </div>
                                <button 
                                    onClick={() => {
                                        if(confirm('ç¢ºå®šè¦æ”¾æ£„ç•¶å‰é€²åº¦ä¸¦é–‹å§‹æ–°éŠæˆ²å—ï¼Ÿ')) {
                                            startNewGame();
                                        }
                                    }}
                                    className="p-2 bg-slate-800/50 hover:bg-slate-700/50 rounded-full transition text-cyan-100 border border-slate-700"
                                    title="æ–°éŠæˆ²"
                                >
                                    <RefreshCw className="w-5 h-5" />
                                </button>
                            </div>
                        </div>
                        
                        <div className="flex justify-between w-full items-center glass-panel p-3 rounded-lg shadow-lg">
                            <div className="flex items-center">
                                <span className="mr-2 text-sm font-medium text-slate-300">é›£åº¦:</span>
                                <select 
                                    value={difficulty} 
                                    onChange={(e) => {
                                        if (timer > 0 && !isWon) {
                                            if(confirm('è®Šæ›´é›£åº¦å°‡é–‹å§‹æ–°éŠæˆ²ï¼Œç¢ºå®šå—ï¼Ÿ')) {
                                                setDifficulty(e.target.value);
                                                startNewGame(e.target.value);
                                            }
                                        } else {
                                            setDifficulty(e.target.value);
                                            startNewGame(e.target.value);
                                        }
                                    }}
                                    className="bg-slate-900/50 border border-slate-600 rounded px-2 py-1 text-sm outline-none focus:border-cyan-500 text-slate-200"
                                >
                                    <option value="Easy">ç°¡å–®</option>
                                    <option value="Medium">ä¸­ç­‰</option>
                                    <option value="Hard">å›°é›£</option>
                                </select>
                            </div>
                            <div className="text-sm text-cyan-300 font-medium">
                                {isNoteMode ? 'âœï¸ è‰ç¨¿æ¨¡å¼' : 'âœï¸ ç­”é¡Œæ¨¡å¼'}
                            </div>
                        </div>
                    </div>

                    {/* ç²å‹ç•«é¢ */}
                    {isWon && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-md">
                            <div className="glass-panel p-8 rounded-2xl shadow-2xl flex flex-col items-center animate-bounce-short border border-cyan-500/30">
                                <Trophy className="w-16 h-16 text-yellow-400 mb-4 drop-shadow-[0_0_10px_rgba(250,204,21,0.5)]" />
                                <h2 className="text-3xl font-bold text-white mb-2">æ­å–œç²å‹ï¼</h2>
                                <p className="text-slate-300 mb-2">é›£åº¦: {difficulty}</p>
                                <p className="text-cyan-300 mb-6 font-mono text-lg">è€—æ™‚: {formatTime(timer)}</p>
                                <button 
                                    onClick={() => startNewGame()}
                                    className="px-6 py-2 bg-gradient-to-r from-cyan-600 to-blue-600 text-white rounded-full hover:from-cyan-500 hover:to-blue-500 transition shadow-lg flex items-center"
                                >
                                    <RefreshCw className="w-4 h-4 mr-2" />
                                    å†ä¾†ä¸€å±€
                                </button>
                            </div>
                        </div>
                    )}

                    {/* ç›¤é¢å€åŸŸ */}
                    <div className="relative glass-panel p-1 rounded-lg shadow-2xl select-none z-10 overflow-hidden">
                        
                        {/* é–‹å§‹éŠæˆ²é®ç½© */}
                        {!isGameStarted && !loading && !isWon && (
                            <div className="absolute inset-0 z-40 flex flex-col items-center justify-center bg-slate-900/80 backdrop-blur-sm">
                                <div className="text-center">
                                    <div className="text-6xl mb-6">ğŸ§©</div>
                                    <button 
                                        onClick={() => setIsGameStarted(true)}
                                        className="group relative px-8 py-3 bg-cyan-600 hover:bg-cyan-500 text-white rounded-full font-bold text-xl shadow-[0_0_20px_rgba(8,145,178,0.5)] transition-all hover:scale-105 active:scale-95 overflow-hidden"
                                    >
                                        <div className="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
                                        <span className="relative flex items-center">
                                            <Play className="w-6 h-6 mr-2 fill-current" />
                                            {timer > 0 ? 'ç¹¼çºŒéŠæˆ²' : 'é–‹å§‹éŠæˆ²'}
                                        </span>
                                    </button>
                                    <p className="mt-4 text-slate-400 text-sm">æŒ‰ä¸‹æŒ‰éˆ•å¾Œé–‹å§‹è¨ˆæ™‚</p>
                                </div>
                            </div>
                        )}

                        {loading ? (
                            <div className="w-[300px] h-[300px] sm:w-[450px] sm:h-[450px] flex items-center justify-center text-cyan-400">
                                ç”Ÿæˆé¡Œç›®ä¸­...
                            </div>
                        ) : (
                            <div 
                                className={`grid grid-cols-9 w-[300px] h-[300px] sm:w-[450px] sm:h-[450px] sudoku-grid border-2 transition-all duration-500 ${!isGameStarted ? 'blur-sm opacity-50' : ''}`}
                                style={{ touchAction: 'manipulation' }}
                            >
                                {gameBoard.map((row, r) => (
                                    row.map((num, c) => (
                                        <div
                                            key={`${r}-${c}`}
                                            onClick={() => setSelectedCell([r, c])}
                                            className={getCellClass(r, c)}
                                        >
                                            {renderCellContent(r, c)}
                                        </div>
                                    ))
                                ))}
                            </div>
                        )}
                    </div>

                    {/* æ§åˆ¶å€ */}
                    <div className="mt-6 w-full max-w-[450px] px-4 z-10">
                        
                        <div className="flex justify-between gap-2 mb-4">
                            <button 
                                onClick={() => setIsNoteMode(false)}
                                disabled={!isGameStarted}
                                className={`flex-1 py-3 rounded-lg flex items-center justify-center font-medium transition-all ${
                                    !isNoteMode 
                                    ? 'bg-cyan-600 text-white shadow-[0_0_10px_rgba(8,145,178,0.4)]' 
                                    : 'glass-panel text-slate-300 hover:bg-white/5'
                                } ${!isGameStarted ? 'opacity-50 cursor-not-allowed' : ''}`}
                            >
                                <span className="mr-2 text-lg">âœï¸</span> ç­”é¡Œ
                            </button>
                            <button 
                                onClick={() => setIsNoteMode(true)}
                                disabled={!isGameStarted}
                                className={`flex-1 py-3 rounded-lg flex items-center justify-center font-medium transition-all ${
                                    isNoteMode 
                                    ? 'bg-pink-600 text-white shadow-[0_0_10px_rgba(219,39,119,0.4)]' 
                                    : 'glass-panel text-slate-300 hover:bg-white/5'
                                } ${!isGameStarted ? 'opacity-50 cursor-not-allowed' : ''}`}
                            >
                                <Pencil className="w-5 h-5 mr-2" /> è‰ç¨¿
                            </button>
                            <button 
                                onClick={handleErase}
                                disabled={!isGameStarted}
                                className={`w-16 rounded-lg flex items-center justify-center glass-panel text-slate-300 hover:bg-white/10 transition-colors ${!isGameStarted ? 'opacity-50 cursor-not-allowed' : ''}`}
                                title="æ¸…é™¤æ ¼å­"
                            >
                                <Eraser className="w-6 h-6" />
                            </button>
                        </div>

                        <div className="grid grid-cols-9 gap-1 sm:gap-2">
                            {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(num => (
                                <button
                                    key={num}
                                    onClick={() => handleNumberInput(num)}
                                    disabled={!isGameStarted}
                                    className={`aspect-square flex items-center justify-center glass-panel rounded shadow text-xl sm:text-2xl font-bold transition border border-white/10 ${
                                        isGameStarted 
                                        ? 'text-cyan-400 hover:bg-cyan-500/20 hover:text-cyan-200 active:bg-cyan-500/40' 
                                        : 'text-slate-600 cursor-not-allowed'
                                    }`}
                                >
                                    {num}
                                </button>
                            ))}
                        </div>
                        
                        <div className="mt-4 text-center text-slate-500 text-xs">
                            éµç›¤æ·å¾‘: æ•¸å­—éµè¼¸å…¥ â€¢ æ–¹å‘éµç§»å‹• â€¢ Backspace æ¸…é™¤ â€¢ N åˆ‡æ›æ¨¡å¼
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
